{"version":3,"sources":["/Users/master/Local Sites/testcursor/backup/src/utils/__tests__/GiverScoreCalculator.test.ts"],"sourcesContent":["import { calculateScoreChange, recalculateScores, determinePersonalityType } from '@/utils/score';\nimport { UserActivityTracker } from '@/utils/activity/UserActivityTracker';\nimport { ActivityType as LearningActivityType } from '@/types/learning';\nimport { ActivityType as QuizActivityType } from '@/types/quiz';\nimport { ActivityType, ScoreActivity, convertActivityType } from '@/types/activity-score';\n\n// UserActivityTrackerのモック\njest.mock('@/utils/activity/UserActivityTracker');\n\ndescribe('GiverScoreCalculator', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('ユーザー活動に基づくスコア計算', () => {\n    it('活動履歴からギバースコアを計算できる', async () => {\n      // モックの活動履歴を設定\n      const mockActivities = [\n        {\n          userId: 'user123',\n          activityType: 'create_material' as LearningActivityType,\n          timestamp: new Date('2023-01-01'),\n          details: { materialType: 'ARTICLE' }\n        },\n        {\n          userId: 'user123',\n          activityType: 'provide_feedback' as LearningActivityType,\n          timestamp: new Date('2023-01-02'),\n          details: { materialType: 'VIDEO' }\n        },\n        {\n          userId: 'user123',\n          activityType: 'complete_resource' as LearningActivityType,\n          timestamp: new Date('2023-01-03'),\n          details: { materialType: 'QUIZ' }\n        }\n      ];\n\n      // UserActivityTrackerのgetUserActivitiesをモック\n      (UserActivityTracker.getUserActivities as jest.Mock).mockResolvedValue(mockActivities);\n\n      // 活動履歴を取得\n      const userId = 'user123';\n      const activities = await UserActivityTracker.getUserActivities(userId);\n\n      // スコア計算用の活動データに変換\n      const scoreActivities: ScoreActivity[] = activities.map(activity => ({\n        activityType: convertActivityType(activity.activityType, 'quiz') as QuizActivityType,\n        materialType: activity.details?.materialType || 'OTHER',\n        timestamp: activity.timestamp\n      }));\n\n      // スコアを計算\n      const scores = recalculateScores(scoreActivities);\n\n      // 計算結果が期待どおりか検証\n      expect(scores.giver).toBeGreaterThan(0);\n      expect(scores.taker).toBeGreaterThan(0);\n      expect(scores.matcher).toBeGreaterThan(0);\n\n      // パーソナリティタイプを決定\n      const personalityType = determinePersonalityType(\n        scores.giver, \n        scores.taker, \n        scores.matcher\n      );\n\n      // タイプが有効な値か確認\n      expect(['giver', 'taker', 'matcher']).toContain(personalityType);\n    });\n\n    it('活動タイプごとに適切なスコア変化が計算される', () => {\n      // 各活動タイプのスコア変化をテスト\n      const createMaterialScore = calculateScoreChange('CREATE_CONTENT' as QuizActivityType);\n      const provideFeedbackScore = calculateScoreChange('PROVIDE_FEEDBACK' as QuizActivityType);\n      const completeResourceScore = calculateScoreChange('CONSUME_CONTENT' as QuizActivityType);\n\n      // 教材作成はギバースコアが高い\n      expect(createMaterialScore.giver).toBeGreaterThan(createMaterialScore.taker);\n      expect(createMaterialScore.giver).toBeGreaterThan(createMaterialScore.matcher);\n\n      // フィードバック提供はマッチャースコアより高いギバースコア\n      expect(provideFeedbackScore.giver).toBeGreaterThan(provideFeedbackScore.matcher);\n\n      // リソース完了はテイカースコアが最も高い\n      expect(completeResourceScore.taker).toBeGreaterThan(completeResourceScore.giver);\n    });\n\n    it('活動カウントからユーザーのタイプを予測できる', async () => {\n      // 活動カウントのモック\n      const mockSummary = {\n        create_material_count: 10,  // ギバー活動が多い\n        provide_feedback_count: 8,\n        complete_resource_count: 5,\n        daily_login_count: 20\n      };\n\n      // UserActivityTrackerのgetActivitySummaryをモック\n      (UserActivityTracker.getActivitySummary as jest.Mock).mockResolvedValue(mockSummary);\n\n      // 活動サマリーを取得\n      const userId = 'user123';\n      const summary = await UserActivityTracker.getActivitySummary(userId);\n\n      // 活動カウントからスコアを推定\n      let giverScore = summary.create_material_count * 5 + summary.provide_feedback_count * 3;\n      let takerScore = summary.complete_resource_count * 2;\n      let matcherScore = summary.create_material_count * 2 + summary.provide_feedback_count + summary.complete_resource_count;\n\n      // 推定されたスコアに基づいてパーソナリティタイプを決定\n      const personalityType = determinePersonalityType(giverScore, takerScore, matcherScore);\n\n      // この活動パターンではギバータイプが予測される\n      expect(personalityType).toBe('giver');\n    });\n  });\n}); "],"names":["jest","mock","describe","beforeEach","clearAllMocks","it","mockActivities","userId","activityType","timestamp","Date","details","materialType","UserActivityTracker","getUserActivities","mockResolvedValue","activities","scoreActivities","map","activity","convertActivityType","scores","recalculateScores","expect","giver","toBeGreaterThan","taker","matcher","personalityType","determinePersonalityType","toContain","createMaterialScore","calculateScoreChange","provideFeedbackScore","completeResourceScore","mockSummary","create_material_count","provide_feedback_count","complete_resource_count","daily_login_count","getActivitySummary","summary","giverScore","takerScore","matcherScore","toBe"],"mappings":"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"}