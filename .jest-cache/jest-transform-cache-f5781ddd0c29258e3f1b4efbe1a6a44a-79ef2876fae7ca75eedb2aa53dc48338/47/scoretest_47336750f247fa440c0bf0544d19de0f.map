{"version":3,"sources":["/Users/master/Local Sites/testcursor/src/utils/__tests__/score.test.ts"],"sourcesContent":["import { \n  calculateTimeDecay, \n  calculateScoreChange, \n  recalculateScores, \n  determinePersonalityType,\n  calculateGiverLevel,\n  calculateProgress\n} from '../score';\nimport { ActivityType, MaterialType } from '@/types/quiz';\n\ndescribe('Score calculation utility functions', () => {\n  describe('calculateTimeDecay', () => {\n    test('時間経過なしの場合は減衰なし（1.0）', () => {\n      expect(calculateTimeDecay(0)).toBeCloseTo(1.0);\n    });\n\n    test('30日経過の場合は約50%に減衰', () => {\n      expect(calculateTimeDecay(30)).toBeCloseTo(0.5, 1);\n    });\n\n    test('60日経過の場合は約25%に減衰', () => {\n      expect(calculateTimeDecay(60)).toBeCloseTo(0.25, 1);\n    });\n\n    test('90日経過の場合は約12.5%に減衰', () => {\n      expect(calculateTimeDecay(90)).toBeCloseTo(0.125, 2);\n    });\n  });\n\n  describe('calculateScoreChange', () => {\n    test('コンテンツ作成はgiverスコアに高い影響を与える', () => {\n      const result = calculateScoreChange('CREATE_CONTENT');\n      expect(result.giver).toBe(5);\n      expect(result.taker).toBe(0);\n      expect(result.matcher).toBe(2);\n    });\n\n    test('コンテンツ消費はtakerスコアに影響を与える', () => {\n      const result = calculateScoreChange('CONSUME_CONTENT');\n      expect(result.giver).toBe(0);\n      expect(result.taker).toBe(2);\n      expect(result.matcher).toBe(1);\n    });\n\n    test('教材タイプによって重み付けされる', () => {\n      const baseResult = calculateScoreChange('CREATE_CONTENT', 'ARTICLE');\n      const quizResult = calculateScoreChange('CREATE_CONTENT', 'QUIZ');\n      \n      // QUIZはARTICLEより高い重み付けを持つ\n      expect(quizResult.giver).toBeGreaterThan(baseResult.giver);\n    });\n\n    test('時間経過によってスコアが減衰する', () => {\n      const nowResult = calculateScoreChange('CREATE_CONTENT', 'ARTICLE', 0);\n      const oldResult = calculateScoreChange('CREATE_CONTENT', 'ARTICLE', 30);\n      \n      // 30日前のアクティビティはスコアが減衰している\n      expect(oldResult.giver).toBeLessThan(nowResult.giver);\n    });\n  });\n\n  describe('recalculateScores', () => {\n    test('複数の活動の合計スコアを計算する', () => {\n      const now = new Date();\n      const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n      const lastWeek = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n      \n      const activities = [\n        { activityType: 'CREATE_CONTENT' as ActivityType, materialType: 'ARTICLE' as MaterialType, timestamp: now },\n        { activityType: 'PROVIDE_FEEDBACK' as ActivityType, materialType: 'QUIZ' as MaterialType, timestamp: yesterday },\n        { activityType: 'CONSUME_CONTENT' as ActivityType, materialType: 'VIDEO' as MaterialType, timestamp: lastWeek }\n      ];\n      \n      const result = recalculateScores(activities);\n      \n      // 計算結果が数値である\n      expect(typeof result.giver).toBe('number');\n      expect(typeof result.taker).toBe('number');\n      expect(typeof result.matcher).toBe('number');\n      \n      // createとprovideは両方giverスコアに寄与する\n      expect(result.giver).toBeGreaterThan(0);\n    });\n\n    test('空の活動リストの場合はゼロを返す', () => {\n      const result = recalculateScores([]);\n      expect(result.giver).toBe(0);\n      expect(result.taker).toBe(0);\n      expect(result.matcher).toBe(0);\n    });\n  });\n\n  describe('determinePersonalityType', () => {\n    test('最高スコアのタイプを返す - giver', () => {\n      expect(determinePersonalityType(10, 5, 3)).toBe('giver');\n    });\n    \n    test('最高スコアのタイプを返す - taker', () => {\n      expect(determinePersonalityType(5, 10, 3)).toBe('taker');\n    });\n    \n    test('最高スコアのタイプを返す - matcher', () => {\n      expect(determinePersonalityType(5, 3, 10)).toBe('matcher');\n    });\n    \n    test('同点の場合は最初に検出されたタイプを返す', () => {\n      // 同点の場合の実際の実装に合わせる\n      expect(determinePersonalityType(10, 10, 10)).toBe('giver');\n    });\n  });\n\n  describe('calculateGiverLevel', () => {\n    test('スコア0の場合はレベル1', () => {\n      expect(calculateGiverLevel(0)).toBe(1);\n    });\n    \n    test('スコア100の場合はレベル2', () => {\n      expect(calculateGiverLevel(100)).toBe(2);\n    });\n    \n    test('スコア950の場合はレベル10', () => {\n      expect(calculateGiverLevel(950)).toBe(10);\n    });\n    \n    test('スコア1500の場合は最大レベル10に制限される', () => {\n      expect(calculateGiverLevel(1500)).toBe(10);\n    });\n  });\n\n  describe('calculateProgress', () => {\n    test('総スコアに対する目標タイプの割合を計算する', () => {\n      const scores = { giver: 60, taker: 30, matcher: 10 };\n      expect(calculateProgress(scores, 'giver')).toBe(60);\n    });\n    \n    test('すべてのスコアが0の場合は0%を返す', () => {\n      const scores = { giver: 0, taker: 0, matcher: 0 };\n      expect(calculateProgress(scores, 'giver')).toBe(0);\n    });\n  });\n}); "],"names":["describe","test","expect","calculateTimeDecay","toBeCloseTo","result","calculateScoreChange","giver","toBe","taker","matcher","baseResult","quizResult","toBeGreaterThan","nowResult","oldResult","toBeLessThan","now","Date","yesterday","getTime","lastWeek","activities","activityType","materialType","timestamp","recalculateScores","determinePersonalityType","calculateGiverLevel","scores","calculateProgress"],"mappings":"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"}