{"version":3,"sources":["/Users/master/Local Sites/testcursor/src/hooks/useActivityLog.ts"],"sourcesContent":["import { useState, useCallback } from 'react';\nimport { ActivityType, ActivityLog, ScoreChange } from '@/types/quiz';\nimport { calculateScoreChange } from '@/utils/score';\n\nexport const useActivityLog = (userId: number) => {\n  const [activityLogs, setActivityLogs] = useState<ActivityLog[]>([]);\n  const [currentScores, setCurrentScores] = useState<ScoreChange>({\n    giver: 0,\n    taker: 0,\n    matcher: 0\n  });\n\n  const logActivity = useCallback(async (activityType: ActivityType) => {\n    const scoreChange = calculateScoreChange(activityType);\n    const newLog: ActivityLog = {\n      id: Date.now(), // 仮のID\n      userId,\n      activityType,\n      scoreChange,\n      createdAt: new Date()\n    };\n\n    try {\n      const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8080';\n      const response = await fetch(`${apiUrl}/log_activity.php`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(newLog),\n      });\n\n      if (!response.ok) {\n        throw new Error('活動ログの保存に失敗しました');\n      }\n\n      setActivityLogs(prev => [...prev, newLog]);\n      setCurrentScores(prev => ({\n        giver: prev.giver + scoreChange.giver,\n        taker: prev.taker + scoreChange.taker,\n        matcher: prev.matcher + scoreChange.matcher\n      }));\n\n      return newLog;\n    } catch (error) {\n      console.error('活動ログの記録中にエラーが発生しました:', error);\n      throw error;\n    }\n  }, [userId]);\n\n  const getRecentActivities = useCallback(async (limit: number = 10) => {\n    try {\n      const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8080';\n      const response = await fetch(`${apiUrl}/get_activities.php?userId=${userId}&limit=${limit}`);\n      \n      if (!response.ok) {\n        throw new Error('活動履歴の取得に失敗しました');\n      }\n\n      const data = await response.json();\n      setActivityLogs(data.activities);\n      return data.activities;\n    } catch (error) {\n      console.error('活動履歴の取得中にエラーが発生しました:', error);\n      throw error;\n    }\n  }, [userId]);\n\n  return {\n    activityLogs,\n    currentScores,\n    logActivity,\n    getRecentActivities\n  };\n}; "],"names":["useActivityLog","userId","activityLogs","setActivityLogs","useState","currentScores","setCurrentScores","giver","taker","matcher","logActivity","useCallback","activityType","scoreChange","calculateScoreChange","newLog","id","Date","now","createdAt","apiUrl","process","env","NEXT_PUBLIC_API_URL","response","fetch","method","headers","body","JSON","stringify","ok","Error","prev","error","console","getRecentActivities","limit","data","json","activities"],"mappings":";;;;+BAIaA;;;eAAAA;;;uBAJyB;uBAED;AAE9B,MAAMA,iBAAiB,CAACC;IAC7B,MAAM,CAACC,cAAcC,gBAAgB,GAAGC,IAAAA,eAAQ,EAAgB,EAAE;IAClE,MAAM,CAACC,eAAeC,iBAAiB,GAAGF,IAAAA,eAAQ,EAAc;QAC9DG,OAAO;QACPC,OAAO;QACPC,SAAS;IACX;IAEA,MAAMC,cAAcC,IAAAA,kBAAW,EAAC,OAAOC;QACrC,MAAMC,cAAcC,IAAAA,2BAAoB,EAACF;QACzC,MAAMG,SAAsB;YAC1BC,IAAIC,KAAKC,GAAG;YACZjB;YACAW;YACAC;YACAM,WAAW,IAAIF;QACjB;QAEA,IAAI;YACF,MAAMG,SAASC,QAAQC,GAAG,CAACC,mBAAmB,IAAI;YAClD,MAAMC,WAAW,MAAMC,MAAM,CAAC,EAAEL,OAAO,iBAAiB,CAAC,EAAE;gBACzDM,QAAQ;gBACRC,SAAS;oBACP,gBAAgB;gBAClB;gBACAC,MAAMC,KAAKC,SAAS,CAACf;YACvB;YAEA,IAAI,CAACS,SAASO,EAAE,EAAE;gBAChB,MAAM,IAAIC,MAAM;YAClB;YAEA7B,gBAAgB8B,CAAAA,OAAQ;uBAAIA;oBAAMlB;iBAAO;YACzCT,iBAAiB2B,CAAAA,OAAS,CAAA;oBACxB1B,OAAO0B,KAAK1B,KAAK,GAAGM,YAAYN,KAAK;oBACrCC,OAAOyB,KAAKzB,KAAK,GAAGK,YAAYL,KAAK;oBACrCC,SAASwB,KAAKxB,OAAO,GAAGI,YAAYJ,OAAO;gBAC7C,CAAA;YAEA,OAAOM;QACT,EAAE,OAAOmB,OAAO;YACdC,QAAQD,KAAK,CAAC,wBAAwBA;YACtC,MAAMA;QACR;IACF,GAAG;QAACjC;KAAO;IAEX,MAAMmC,sBAAsBzB,IAAAA,kBAAW,EAAC,OAAO0B,QAAgB,EAAE;QAC/D,IAAI;YACF,MAAMjB,SAASC,QAAQC,GAAG,CAACC,mBAAmB,IAAI;YAClD,MAAMC,WAAW,MAAMC,MAAM,CAAC,EAAEL,OAAO,2BAA2B,EAAEnB,OAAO,OAAO,EAAEoC,MAAM,CAAC;YAE3F,IAAI,CAACb,SAASO,EAAE,EAAE;gBAChB,MAAM,IAAIC,MAAM;YAClB;YAEA,MAAMM,OAAO,MAAMd,SAASe,IAAI;YAChCpC,gBAAgBmC,KAAKE,UAAU;YAC/B,OAAOF,KAAKE,UAAU;QACxB,EAAE,OAAON,OAAO;YACdC,QAAQD,KAAK,CAAC,wBAAwBA;YACtC,MAAMA;QACR;IACF,GAAG;QAACjC;KAAO;IAEX,OAAO;QACLC;QACAG;QACAK;QACA0B;IACF;AACF"}