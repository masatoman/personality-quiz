# 🔍 環境別確認チェックリスト

## 📋 **概要**
開発環境、ステージング環境、本番環境それぞれで確認すべき項目を体系的にまとめます。各環境の目的に応じた最適な確認項目を定義し、品質と安全性を確保します。

## 🎯 **各環境の目的と確認重点**

| 環境 | 主な目的 | 確認重点 | 許容リスク |
|------|----------|-----------|------------|
| 🖥️ **開発** | 機能開発・デバッグ | 機能実装・バグ修正 | 高（実験的） |
| 🧪 **ステージング** | 本番前検証 | 統合テスト・パフォーマンス | 中（制御可能） |
| 🚀 **本番** | ユーザー提供 | 安定性・セキュリティ | 極低（ゼロ障害） |

---

## 🖥️ **開発環境（Docker Supabase）確認項目**

### 🎯 **開発環境の目的**
- 新機能の実装とテスト
- バグの再現と修正
- 実験的な改善の検証

### ✅ **機能開発確認項目**

#### 🔧 **基本環境確認**
```bash
# Docker Supabase起動確認
docker-compose ps
curl -I http://localhost:3003/

# Next.js開発サーバー確認
curl -I http://localhost:3000/

# データベース接続確認
curl -s "http://localhost:3003/profiles" | head -5
```

**チェックリスト:**
- [ ] Docker Supabaseサービス全起動
- [ ] PostgreSQL接続可能
- [ ] PostgREST API応答正常
- [ ] Next.js開発サーバー起動
- [ ] ホットリロード動作

#### 🎨 **UI/UX確認**
- [ ] 新機能のUI表示正常
- [ ] レスポンシブデザイン動作
- [ ] アクセシビリティ基本準拠
- [ ] エラー表示適切
- [ ] ローディング状態表示

#### 🔗 **API機能確認**
```bash
# 主要APIエンドポイント確認
curl -s "http://localhost:3003/profiles"
curl -s "http://localhost:3003/materials"
curl -s "http://localhost:3003/user_behavior_logs"
curl -s "http://localhost:3003/giver_scores"
```

**チェックリスト:**
- [ ] CRUD操作すべて正常
- [ ] エラーハンドリング適切
- [ ] データ検証機能動作
- [ ] 認証・認可機能動作
- [ ] リアルタイム更新動作

#### 🧪 **テスト実行確認**
```bash
# 開発環境テストスイート
npm run type-check          # TypeScript型チェック
npm run lint                # ESLint
npm run test:unit           # 単体テスト
npm run test:integration    # 統合テスト
```

**合格基準:**
- [ ] TypeScript型エラー: **0件**
- [ ] ESLintエラー: **0件**
- [ ] 単体テストカバレッジ: **80%以上**
- [ ] 統合テスト: **全合格**

#### ⚡ **パフォーマンス基本確認**
- [ ] ページロード時間: **< 3秒**
- [ ] API応答時間: **< 1秒**
- [ ] メモリリーク: **なし**
- [ ] コンソールエラー: **関連エラーのみ**

#### 🔄 **データ整合性確認**
- [ ] 新規データ作成・保存
- [ ] 既存データ更新・削除
- [ ] リレーション整合性維持
- [ ] バックアップ・復元動作

---

## 🧪 **ステージング環境確認項目**

### 🎯 **ステージング環境の目的**
- 本番環境と同等条件での検証
- 統合テストとパフォーマンステスト
- 本番デプロイ前の最終確認

### ✅ **統合テスト確認項目**

#### 🌐 **基本接続確認**
```bash
# ステージング環境基本確認
curl -I https://staging.shiftwith.app/
curl -s "https://staging.shiftwith.app/api/profiles"

# DNS・SSL確認
nslookup staging.shiftwith.app
openssl s_client -connect staging.shiftwith.app:443 -servername staging.shiftwith.app < /dev/null
```

**チェックリスト:**
- [ ] HTTPS接続正常
- [ ] SSL証明書有効
- [ ] DNS解決正常
- [ ] CDN配信正常
- [ ] 基本ページロード正常

#### 🔐 **認証フロー確認**
```bash
# 認証API確認（自動化テスト）
npm run test:e2e:auth
```

**手動確認項目:**
- [ ] 新規ユーザー登録フロー
- [ ] メール認証フロー
- [ ] ログイン・ログアウト
- [ ] パスワードリセット
- [ ] プロフィール更新
- [ ] セッション管理

#### 🎓 **教材システム確認**
```bash
# 教材系API確認
curl -s "https://staging.shiftwith.app/api/materials"
curl -s "https://staging.shiftwith.app/api/categories"
```

**手動確認項目:**
- [ ] 教材作成フロー（StandardCreator）
- [ ] 教材一覧表示・検索
- [ ] 教材詳細表示
- [ ] 学習履歴記録
- [ ] 進捗データ同期

#### 📊 **ダッシュボード確認**
- [ ] ユーザー統計表示
- [ ] ギバースコア計算・表示
- [ ] アクティビティログ表示
- [ ] ランキング表示
- [ ] バッジシステム動作

#### ⚡ **パフォーマンステスト**
```bash
# Lighthouse監査実行
lighthouse https://staging.shiftwith.app/ --output json
```

**合格基準:**
- [ ] Core Web Vitals: **Good**
- [ ] LCP (Largest Contentful Paint): **< 2.5秒**
- [ ] FID (First Input Delay): **< 100ms**
- [ ] CLS (Cumulative Layout Shift): **< 0.1**
- [ ] Performance Score: **> 90**

#### 🔍 **セキュリティ確認**
```bash
# セキュリティスキャン
npm audit
snyk test
```

**確認項目:**
- [ ] XSS対策実装
- [ ] CSRF対策実装
- [ ] SQL Injection対策
- [ ] 認証・認可適切
- [ ] 機密データ保護

#### 📱 **レスポンシブ確認**
- [ ] モバイル表示（375px〜）
- [ ] タブレット表示（768px〜）
- [ ] デスクトップ表示（1024px〜）
- [ ] タッチ操作対応
- [ ] キーボード操作対応

#### 🧪 **E2Eテスト確認**
```bash
# 自動E2Eテスト実行
npm run test:e2e:staging
```

**カバー項目:**
- [ ] ユーザージャーニー全体
- [ ] 主要機能フロー
- [ ] エラーハンドリング
- [ ] ブラウザ互換性
- [ ] パフォーマンス劣化なし

#### 🔄 **データ移行確認**
- [ ] 本番データとの整合性
- [ ] マイグレーション正常実行
- [ ] ロールバック可能性
- [ ] データ破損なし

---

## 🚀 **本番環境確認項目**

### 🎯 **本番環境の目的**
- 実ユーザーへの安定サービス提供
- 障害ゼロの運用継続
- ビジネス価値の継続的提供

### ✅ **本番デプロイ直後確認（5分以内）**

#### 🚨 **即座確認項目**
```bash
# 緊急確認スクリプト
./scripts/production-health-check.sh
```

**チェックリスト:**
- [ ] サイト基本アクセス可能
- [ ] 主要ページロード正常
- [ ] API基本応答正常
- [ ] ユーザーログイン可能
- [ ] 重要機能動作確認

#### 🔍 **基本接続確認**
```bash
# 本番環境基本確認
curl -I https://shiftwith-sigma.vercel.app/
curl -s "https://shiftwith-sigma.vercel.app/api/profiles" | head -5
curl -s "https://shiftwith-sigma.vercel.app/dashboard"
```

### ✅ **本番運用確認（30分以内）**

#### 🎯 **ユーザー体験確認**
- [ ] 新規ユーザー登録可能
- [ ] 既存ユーザーログイン可能
- [ ] 教材作成・閲覧可能
- [ ] データ保存・同期正常
- [ ] 決済機能動作（該当時）

#### 📊 **監視ダッシュボード確認**
```bash
# 監視データ確認
npm run deploy:status:production
vercel logs production --limit 50
```

**確認項目:**
- [ ] エラー率: **< 0.1%**
- [ ] 応答時間: **平均 < 1秒**
- [ ] 稼働率: **100%**
- [ ] メモリ使用量: **正常範囲**
- [ ] CPU使用率: **正常範囲**

#### 🔐 **セキュリティ監視**
- [ ] 不正アクセス検知なし
- [ ] DDoS攻撃兆候なし
- [ ] 機密データ漏洩なし
- [ ] 認証バイパス試行なし
- [ ] SQL Injection試行なし

#### 💾 **データ整合性確認**
- [ ] ユーザーデータ整合性
- [ ] 教材データ整合性
- [ ] 学習履歴データ整合性
- [ ] ギバースコアデータ整合性
- [ ] バックアップ正常実行

### ✅ **本番継続監視（24時間）**

#### 📈 **ビジネスメトリクス**
- [ ] ユーザー登録数
- [ ] アクティブユーザー数
- [ ] 教材作成数
- [ ] 学習セッション数
- [ ] ユーザー満足度

#### 🔍 **技術メトリクス**
- [ ] サーバー応答時間
- [ ] データベース応答時間
- [ ] CDN キャッシュヒット率
- [ ] エラー発生パターン
- [ ] リソース使用量トレンド

#### 🚨 **アラート監視**
```bash
# アラート設定確認
# - エラー率 > 1%
# - 応答時間 > 3秒
# - 稼働率 < 99.9%
# - メモリ使用量 > 80%
```

---

## 🛠️ **確認自動化スクリプト**

### 🖥️ **開発環境確認スクリプト**
```bash
#!/bin/bash
# scripts/dev-check.sh

echo "🖥️ 開発環境確認開始..."

# Docker確認
docker-compose ps | grep -q "Up" || exit 1

# API確認
curl -f http://localhost:3003/ > /dev/null || exit 1
curl -f http://localhost:3000/ > /dev/null || exit 1

# テスト実行
npm run type-check || exit 1
npm run lint || exit 1
npm run test:unit || exit 1

echo "✅ 開発環境確認完了"
```

### 🧪 **ステージング確認スクリプト**
```bash
#!/bin/bash
# scripts/staging-check.sh

echo "🧪 ステージング環境確認開始..."

# 基本接続確認
curl -f https://staging.shiftwith.app/ > /dev/null || exit 1
curl -f https://staging.shiftwith.app/api/profiles > /dev/null || exit 1

# パフォーマンス確認
response_time=$(curl -o /dev/null -s -w '%{time_total}' https://staging.shiftwith.app/)
if (( $(echo "$response_time > 3.0" | bc -l) )); then
  echo "❌ 応答時間が遅すぎます: ${response_time}秒"
  exit 1
fi

# E2Eテスト実行
npm run test:e2e:staging || exit 1

echo "✅ ステージング環境確認完了"
```

### 🚀 **本番確認スクリプト**
```bash
#!/bin/bash
# scripts/production-check.sh

echo "🚀 本番環境確認開始..."

# 緊急確認
curl -f https://shiftwith-sigma.vercel.app/ > /dev/null || exit 1
curl -f https://shiftwith-sigma.vercel.app/api/profiles > /dev/null || exit 1

# 応答時間確認
response_time=$(curl -o /dev/null -s -w '%{time_total}' https://shiftwith-sigma.vercel.app/)
if (( $(echo "$response_time > 2.0" | bc -l) )); then
  echo "⚠️ 応答時間注意: ${response_time}秒"
fi

# SSL確認
echo | openssl s_client -connect shiftwith-sigma.vercel.app:443 -servername shiftwith-sigma.vercel.app 2>/dev/null | openssl x509 -noout -dates

echo "✅ 本番環境確認完了"
```

---

## 📊 **確認項目マトリックス**

| 確認カテゴリ | 🖥️ 開発 | 🧪 ステージング | 🚀 本番 |
|--------------|----------|----------------|---------|
| **基本接続** | ✅ 必須 | ✅ 必須 | ✅ 必須 |
| **機能テスト** | ✅ 詳細 | ✅ 網羅的 | ✅ 重要機能 |
| **パフォーマンス** | 🔄 基本 | ✅ 詳細 | ✅ 継続監視 |
| **セキュリティ** | 🔄 基本 | ✅ 詳細 | ✅ 厳重監視 |
| **UI/UX** | ✅ 詳細 | ✅ 網羅的 | 🔄 重要部分 |
| **データ整合性** | ✅ 必須 | ✅ 必須 | ✅ 継続監視 |
| **ビジネス影響** | ➖ 対象外 | 🔄 一部 | ✅ 継続監視 |

**凡例:**
- ✅ 必須・詳細確認
- 🔄 部分的・基本確認  
- ➖ 確認対象外

---

## 🎯 **環境別合格基準**

### 🖥️ **開発環境合格基準**
- 新機能正常動作
- 既存機能影響なし
- テストカバレッジ80%以上
- 重大なパフォーマンス劣化なし

### 🧪 **ステージング合格基準**
- 全機能100%正常動作
- Performance Score > 90
- エラー率 < 1%
- セキュリティ脆弱性0件

### 🚀 **本番合格基準**
- 稼働率99.9%以上
- エラー率 < 0.1%
- 平均応答時間 < 1秒
- ユーザー影響ゼロ

---

## 📝 **チェックリスト運用方法**

### 📋 **確認記録テンプレート**
```markdown
## 環境確認記録

**日時**: YYYY-MM-DD HH:MM JST
**環境**: 開発/ステージング/本番
**担当者**: [名前]
**対象**: [機能・変更内容]

### ✅ 確認完了項目
- [x] 基本接続確認
- [x] 機能動作確認
- [x] パフォーマンス確認

### ❌ 問題項目
- [ ] [問題内容と対応予定]

### 📝 備考
[特記事項]
```

### 🔄 **継続改善**
- 月次でチェックリスト見直し
- 問題パターンの分析・対策
- 自動化項目の拡充
- チーム教育・共有

---

## 🎉 **まとめ**

各環境で適切な確認を行うことで：

1. **🖥️ 開発効率**: 早期バグ検知・修正
2. **🧪 品質保証**: 本番前完全検証
3. **🚀 安定運用**: ユーザー影響最小化

このチェックリストを活用して、**安全で高品質なサービス**を継続的に提供しましょう！
