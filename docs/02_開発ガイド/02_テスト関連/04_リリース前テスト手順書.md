# ShiftWith MVP リリース前テスト手順書

## 📋 概要

本文書は ShiftWith MVP のリリース前に実行すべきテストの手順を記載しています。
段階的にテストを実行し、リリース品質の確認を行います。

## 🎯 テストの種類と目的

### 1. **スモークテスト** (`test:smoke`)
- **目的**: 最重要機能が動作するかの高速確認
- **実行時間**: 3-5分
- **実行タイミング**: リリース直前、緊急修正後

### 2. **リリース準備テスト** (`test:release`)
- **目的**: 包括的なユーザーフロー検証
- **実行時間**: 15-30分
- **実行タイミング**: リリース前最終確認

### 3. **完全リリーステスト** (`test:full-release`)
- **目的**: 全レイヤーの品質確認
- **実行時間**: 45-60分
- **実行タイミング**: 重要リリース前

---

## 🚀 実行手順

### Phase 1: 事前準備

```bash
# 1. 開発サーバーの起動確認
npm run dev

# 2. 依存関係とブラウザーの確認
npm run playwright:install

# 3. データベース接続確認
npm run test:supabase
```

### Phase 2: スモークテスト実行 ⚡

```bash
# 基本動作確認（最優先）
npm run test:smoke

# 並列実行で高速化
npm run test:smoke:fast

# 問題があれば UI モードで詳細確認
npm run test:smoke:headed
```

**期待結果**: 全テスト成功 ✅

#### スモークテスト項目
- ✅ アプリケーション基本起動
- ✅ 認証システム基本動作
- ✅ ギバー診断システム基本動作
- ✅ 教材システム基本動作
- ✅ ダッシュボード認証制御
- ✅ ランキングシステム基本動作
- ✅ 主要API基本応答
- ✅ レスポンシブデザイン基本確認
- ✅ ページロード速度基本確認
- ✅ 基本セキュリティ設定

### Phase 3: リリース準備テスト実行 🎯

```bash
# 包括的E2Eテスト実行
npm run test:release

# 問題があれば UI モードで詳細確認
npm run test:release:ui
```

**期待結果**: 主要フロー成功率 85%以上

#### リリース準備テスト項目
1. **新規ユーザー完全オンボーディング体験**
   - サインアップ → ギバー診断 → ダッシュボード
2. **教材作成・公開・学習の包括的フロー**
   - 教材作成 → 公開 → 他ユーザーでの学習
3. **ポイントシステムとギバー報酬の正確性**
   - 各種行動でのポイント獲得確認
4. **エラー処理とシステム回復力**
   - 異常系シナリオでの動作確認
5. **ランキングシステムの正確性**
   - データ表示と計算の妥当性確認
6. **主要ページのロード性能確認**
   - 応答速度とユーザー体験の確認

### Phase 4: 完全リリーステスト実行 🏆

```bash
# 全レイヤーテスト実行（最高品質確認）
npm run test:full-release
```

**期待結果**: 全項目成功 ✅

#### 実行内容
1. Lint + TypeScript チェック
2. 単体テスト
3. Supabase統合テスト
4. スモークテスト
5. リリース準備テスト

---

## 🔍 トラブルシューティング

### よくある問題と対処法

#### 1. **テストがタイムアウトする**
```bash
# タイムアウト時間を延長
npx playwright test tests/e2e/release-smoke-test.e2e.test.ts --timeout=60000
```

#### 2. **データベース接続エラー**
```bash
# 環境変数を確認
source ./set_env.sh
npm run test:supabase:debug
```

#### 3. **認証エラーが発生する**
```bash
# テストユーザーの作成確認
# /api/setup/register-test-users にアクセス
```

#### 4. **UI要素が見つからない**
```bash
# 要素のdata-testid属性を確認
npm run test:smoke:headed
```

### エラー修正後の再実行

```bash
# 修正後の段階的確認
npm run test:critical      # 最重要のみ
npm run test:smoke        # 基本動作
npm run test:release      # 完全フロー
```

---

## 📊 テスト結果の判定基準

### ✅ **リリース可能レベル**
- スモークテスト: 100% 成功
- リリース準備テスト: 85% 以上成功
- 重大なセキュリティ・データ損失リスクなし

### ⚠️ **条件付きリリース**
- スモークテスト: 90% 以上成功
- リリース準備テスト: 70% 以上成功
- 既知の問題を文書化済み

### ❌ **リリース延期**
- スモークテスト: 90% 未満
- 重大なセキュリティ問題あり
- データ損失リスクあり

---

## 🎉 リリース直前チェックリスト

### 技術的確認
- [ ] `npm run test:smoke` 全成功
- [ ] `npm run test:release` 85%以上成功
- [ ] データベース本番同期完了
- [ ] 環境変数設定確認
- [ ] Vercelデプロイ設定確認

### ビジネス確認
- [ ] 初期コンテンツ登録完了（10教材以上）
- [ ] 利用規約・プライバシーポリシー設置
- [ ] エラー監視設定完了
- [ ] カスタマーサポート体制準備

### 最終動作確認
- [ ] 本番環境での手動テスト実行
- [ ] 異なるブラウザでの動作確認
- [ ] モバイルデバイスでの動作確認
- [ ] 負荷テスト実行（オプション）

---

## 📞 緊急時対応

### リリース後に問題が発生した場合

1. **即座にロールバック検討**
   ```bash
   # Vercelでの前バージョンへの切り戻し
   vercel rollback
   ```

2. **監視とログ確認**
   - エラー率の監視
   - ユーザー行動ログの確認
   - データベース整合性確認

3. **ユーザー通知**
   - 問題の影響範囲通知
   - 復旧予定時間の告知
   - 代替手段の提供

---

## 📈 継続改善

### テスト結果の活用
- 失敗頻度の高いテストケースの改善
- 新機能追加時のテスト追加
- パフォーマンス劣化の早期発見

### 次回リリースへの改善点
- テスト自動化の拡充
- CI/CDパイプラインの改善
- 監視・アラート体制の強化

---

**📝 最終更新**: 2025年1月 - ShiftWith MVP v1.0 リリース準備版 