# AGENT_INDEX - ShiftWithプロジェクト技術情報

このファイルはCursorエージェントが技術情報を効率的に参照するための特別なインデックスです。

> 📝 **最終更新日**: 2023-06-15

## 技術スタック概要

| レイヤー | 技術 | バージョン | 備考 |
|---------|------|-----------|------|
| フロントエンド | Next.js | 13.x | App Router採用 |
| | React | 18.x | Hooks中心実装 |
| | Tailwind CSS | 3.x | ユーティリティファースト |
| バックエンド | Supabase | 最新 | BaaS (Auth/DB/Storage) |
| | PostgreSQL | 14.x | RLS機能活用 |
| デプロイ | Hostinger VPS | Ubuntu 22.04 | 本番環境 |
| | GitHub Actions | 最新 | CI/CD |
| | Cloudflare | 最新 | CDN/DNS |

## ディレクトリ構造ハイライト

```
src/
├── app/                  # Next.js App Router
│   ├── (auth)/           # 認証関連ページ
│   ├── (main)/           # 認証後メインページ
│   └── api/              # APIルート
├── components/           # Reactコンポーネント
│   ├── atoms/            # 基本UIコンポーネント
│   ├── molecules/        # 複合UIコンポーネント
│   └── organisms/        # 機能ブロック
├── hooks/                # カスタムフック
├── lib/                  # ユーティリティ
│   ├── supabase/         # Supabase連携
│   └── api/              # API連携
├── types/                # TypeScript型定義
└── styles/               # グローバルスタイル
```

## データベースモデル概要

| テーブル名 | 主要フィールド | 関連テーブル | 説明 |
|----------|--------------|------------|------|
| users | id, email, created_at | profiles | 認証ユーザー |
| profiles | user_id, username, giver_level | users, materials | ユーザープロフィール |
| materials | id, title, author_id, status | profiles, material_sections | 教材 |
| material_sections | id, material_id, title, content | materials | 教材セクション |
| giver_scores | id, user_id, score_type, score_value | profiles | ギバースコアイベント |

## キー機能コンポーネント

| 機能 | 実装ファイル | 関連API | 説明 |
|-----|------------|--------|------|
| 認証 | `components/organisms/AuthForm` | `/auth/v1/signup`, `/auth/v1/token` | ログイン・サインアップ |
| 教材作成 | `components/organisms/MaterialEditor` | `/materials` | 教材編集 |
| 教材表示 | `components/organisms/MaterialViewer` | `/materials?id=eq.[ID]` | 教材閲覧 |
| ギバースコア | `components/molecules/GiverScoreCard` | `/giver_scores`, `/rpc/get_giver_score_summary` | スコア表示 |

## 重要API仕様

### 認証系
- Base: `https://[PROJECT_ID].supabase.co/auth/v1/`
- 認証ヘッダ必須: `apikey`, `Authorization: Bearer [token]`

### データ系
- Base: `https://[PROJECT_ID].supabase.co/rest/v1/`
- 認証ヘッダ必須: `apikey`, `Authorization: Bearer [token]`
- フィルタリング: `?column=eq.value`
- 関連データ: `?select=*,relation(*)`

## 主要実装特性

### 行動変容戦略
- 小さなギバー行動の積み重ね
- 視覚的フィードバックによる動機づけ
- 社会的証明の活用

### パフォーマンス最適化
- ISR (Incremental Static Regeneration)
- Edgeキャッシュ活用
- サーバーサイド処理の優先

### セキュリティ対策
- RLS (Row Level Security)の徹底
- JWTベースの認証
- CSP実装

## 実装順序参照
- MVP (8週間): 基本認証 → ギバー診断 → 教材基本機能 → ポイントシステム
- フェーズ1 (6週間): 教材評価 → ギバー成長システム → 友達招待 → AI初期機能
- フェーズ2 (8週間): マネタイズ機能 → AI強化 → ソーシャル機能

## 問題解決ガイド

### エラー種別と対処
- 認証エラー: トークン有効期限確認、リフレッシュトークン更新
- APIエラー: RLSポリシー確認、パラメータ検証
- UI不整合: コンポーネント依存関係確認、状態管理再考
- パフォーマンス問題: クエリ最適化、レンダリング最適化

### テスト参照
- 単体テスト: `*.test.ts(x)` - 各コンポーネント・関数ごと
- 統合テスト: `__tests__/integration/` - 複数機能連携
- E2Eテスト: `cypress/e2e/` - ユーザーフロー検証

## ドキュメント相互参照

| 実装目的 | 主ドキュメント | 関連ドキュメント |
|---------|--------------|----------------|
| API実装 | [APIインターフェース仕様書](./02_開発ガイド/04_APIインターフェース仕様書.md) | [データベース詳細設計](./01_プロジェクト概要/05_データベース詳細設計.md) |
| UI実装 | [コンポーネント詳細設計](./01_プロジェクト概要/06_コンポーネント詳細設計.md) | [UI/UXデザイン仕様書](./01_プロジェクト概要/07_UI_UXデザイン仕様書.md) |
| 認証実装 | [セキュリティ設計](./02_開発ガイド/05_セキュリティ設計.md) | [APIインターフェース仕様書](./02_開発ガイド/04_APIインターフェース仕様書.md) |
| テスト作成 | [テスト標準](./02_開発ガイド/02_テスト標準.md) | [テストガイド](./02_開発ガイド/03_テストガイド.md) |
| デプロイ | [デプロイメント構成図](./02_開発ガイド/06_デプロイメント構成図.md) | [セキュリティ設計](./02_開発ガイド/05_セキュリティ設計.md) |

## ユースケース別参照パターン

エージェントが一般的なタスクを完了するための参照ガイド

### 1. 新機能実装

**シナリオ**: 新しい機能を実装する際の参照フロー

1. **要件把握**:
   - [機能仕様書](./01_プロジェクト概要/02_機能仕様書.md) - 具体的な機能要件
   - [機能の優先順位とスケジュール](./01_プロジェクト概要/04_機能の優先順位とスケジュール.md) - 現在のフェーズと優先度

2. **データモデリング**:
   - [データベース詳細設計](./01_プロジェクト概要/05_データベース詳細設計.md) - 既存テーブル構造
   - [セキュリティ設計](./02_開発ガイド/05_セキュリティ設計.md) - RLSポリシー

3. **API設計**:
   - [APIインターフェース仕様書](./02_開発ガイド/04_APIインターフェース仕様書.md) - API設計パターン

4. **UI実装**:
   - [コンポーネント詳細設計](./01_プロジェクト概要/06_コンポーネント詳細設計.md) - コンポーネント構造
   - [UI/UXデザイン仕様書](./01_プロジェクト概要/07_UI_UXデザイン仕様書.md) - デザインガイドライン

5. **テスト作成**:
   - [テスト標準](./02_開発ガイド/02_テスト標準.md) - テスト方針
   - [コロケーション方式テスト構造](../src/utils/migration-plan.md) - テストファイル配置

### 2. バグ修正

**シナリオ**: 既存機能のバグ修正

1. **問題特定**:
   - [コンポーネント詳細設計](./01_プロジェクト概要/06_コンポーネント詳細設計.md) - 関連コンポーネント特定
   - [データベース詳細設計](./01_プロジェクト概要/05_データベース詳細設計.md) - データフロー確認

2. **修正実装**:
   - [テスト標準](./02_開発ガイド/02_テスト標準.md) - テストケース作成
   - [セキュリティ設計](./02_開発ガイド/05_セキュリティ設計.md) - セキュリティ配慮事項

3. **検証**:
   - [テストガイド](./02_開発ガイド/03_テストガイド.md) - テスト実行方法

### 3. リファクタリング

**シナリオ**: コード品質向上のためのリファクタリング

1. **対象特定**:
   - [ディレクトリ構造](./02_開発ガイド/01_ディレクトリ構造.md) - コード編成ルール
   - [コンポーネント詳細設計](./01_プロジェクト概要/06_コンポーネント詳細設計.md) - コンポーネント責務

2. **実装**:
   - [コロケーション方式テスト構造](../src/utils/migration-plan.md) - ファイル配置ルール
   - [テスト標準](./02_開発ガイド/02_テスト標準.md) - テスト修正ガイド

### 4. ドキュメント更新

**シナリオ**: ドキュメント更新や拡張

1. **更新対象**:
   - [README.md](./README.md) - 全体構成把握
   - [GLOSSARY.md](./GLOSSARY.md) - 用語確認

2. **更新ルール**:
   - 相互リンクの維持
   - 最終更新日の記録
   - 関連ドキュメントセクションの更新

## 用語・概念リファレンス

プロジェクト固有の用語や概念の詳細は [GLOSSARY.md](./GLOSSARY.md) を参照してください。主要な用語：

- **ギバー (Giver)**: コミュニティに知識提供する人
- **ギバースコア (Giver Score)**: 貢献度合いを数値化
- **コロケーション方式 (Colocation)**: 関連コードファイルを同一ディレクトリに配置

## コロケーション方式テスト構造

**概要**: 関連するコンポーネント・ロジックとそのテストを同じディレクトリに配置する手法

**ディレクトリ構造例**:
```
components/
  Button/
    Button.tsx      # コンポーネント
    Button.test.tsx # テスト
    styles.module.css # スタイル
    index.ts       # エクスポート
```

**移行計画**: [コロケーション方式テスト構造への移行計画](../src/utils/migration-plan.md)

**メリット**:
- 関連コードの発見容易性向上
- コンポーネント単位での作業効率化
- テストカバレッジの視認性向上
